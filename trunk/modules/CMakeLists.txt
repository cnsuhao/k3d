INCLUDE_DIRECTORIES(${k3d_SOURCE_DIR})
INCLUDE_DIRECTORIES(${k3dsdk_SOURCE_DIR}/gil)
INCLUDE_DIRECTORIES(${k3dsdk_BINARY_DIR})
INCLUDE_DIRECTORIES(${K3D_BOOST_INCLUDE_DIRS})
INCLUDE_DIRECTORIES(${K3D_GLIBMM_INCLUDE_DIRS})
INCLUDE_DIRECTORIES(${K3D_SIGC_INCLUDE_DIRS})
INCLUDE_DIRECTORIES(${K3D_OPENGL_INCLUDE_DIR})

LINK_DIRECTORIES(${K3D_BOOST_LIB_DIRS})
LINK_DIRECTORIES(${K3D_SIGC_LIB_DIRS})

LINK_LIBRARIES(k3dsdk)

IF(K3D_BUILD_NLS)
	INCLUDE_DIRECTORIES(${K3D_INTL_INCLUDE_DIRS})
	LINK_LIBRARIES(${K3D_INTL_LIBS})
ENDIF(K3D_BUILD_NLS)

SET(LIBRARY_OUTPUT_PATH ${k3d_BINARY_DIR}/lib/k3d/plugins)

MACRO(K3D_BUILD_MODULE PLUGIN_NAME)
	PROJECT(${PLUGIN_NAME})

	FILE(GLOB HEADERS *.h)
	FILE(GLOB SOURCES *.cpp)

	IF(CMAKE_HAS_SORT)
		LIST(SORT HEADERS)
		LIST(SORT SOURCES)
	ENDIF(CMAKE_HAS_SORT)

	ADD_LIBRARY(${PROJECT_NAME} SHARED ${HEADERS} ${SOURCES})
	SET_TARGET_PROPERTIES(${PROJECT_NAME} PROPERTIES PREFIX "" SUFFIX ".module")

	INSTALL(TARGETS ${PROJECT_NAME}
		RUNTIME DESTINATION lib/k3d/plugins
		LIBRARY DESTINATION lib/k3d/plugins)
		
ENDMACRO(K3D_BUILD_MODULE)

MACRO(K3D_BUILD_EXTERNAL_MODULE PLUGIN_NAME SOURCE_DIR)
	PROJECT(${PLUGIN_NAME})

	FILE(GLOB HEADERS ${SOURCE_DIR}/*.h)
	FILE(GLOB SOURCES ${SOURCE_DIR}/*.cpp)
	
	IF(CMAKE_HAS_SORT)
		LIST(SORT HEADERS)
		LIST(SORT SOURCES)
	ENDIF(CMAKE_HAS_SORT)

	ADD_LIBRARY(${PROJECT_NAME} SHARED ${HEADERS} ${SOURCES})
	SET_TARGET_PROPERTIES(${PROJECT_NAME} PROPERTIES PREFIX "" SUFFIX ".module")
	
	INSTALL(TARGETS ${PROJECT_NAME}
		RUNTIME DESTINATION lib/k3d/plugins
		LIBRARY DESTINATION lib/k3d/plugins)

ENDMACRO(K3D_BUILD_EXTERNAL_MODULE)

MACRO(K3D_CREATE_MODULE_PROXY MODULE_NAME)
	GET_TARGET_PROPERTY(K3D_MAKE_MODULE_PROXY k3d-make-module-proxy LOCATION)
	GET_TARGET_PROPERTY(MODULE ${MODULE_NAME} LOCATION)
	ADD_CUSTOM_COMMAND(
		OUTPUT ${MODULE}.proxy
		COMMAND ${K3D_MAKE_MODULE_PROXY} ${MODULE} > ${MODULE}.proxy
		DEPENDS k3d-make-module-proxy ${MODULE_NAME}
		)
	ADD_CUSTOM_TARGET(${MODULE_NAME}-proxy ALL DEPENDS ${MODULE}.proxy)
	INSTALL(FILES ${MODULE}.proxy DESTINATION lib/k3d/plugins)
ENDMACRO(K3D_CREATE_MODULE_PROXY)

IF(K3D_BUILD_ANIMATION_MODULE)
	ADD_SUBDIRECTORY(animation)
ENDIF(K3D_BUILD_ANIMATION_MODULE)

IF(K3D_BUILD_ANNOTATION_MODULE)
	ADD_SUBDIRECTORY(annotation)
ENDIF(K3D_BUILD_ANNOTATION_MODULE)

IF(K3D_BUILD_AQSIS_MODULE)
	ADD_SUBDIRECTORY(aqsis)
ENDIF(K3D_BUILD_AQSIS_MODULE)

IF(K3D_BUILD_ARRAY_MODULE)
	ADD_SUBDIRECTORY(array)
ENDIF(K3D_BUILD_ARRAY_MODULE)

IF(K3D_BUILD_BILINEAR_PATCH_MODULE)
	ADD_SUBDIRECTORY(bilinear_patch)
ENDIF(K3D_BUILD_BILINEAR_PATCH_MODULE)

IF(K3D_BUILD_BICUBIC_PATCH_MODULE)
	ADD_SUBDIRECTORY(bicubic_patch)
ENDIF(K3D_BUILD_BICUBIC_PATCH_MODULE)

IF(K3D_BUILD_BITMAP_MODULE)
	ADD_SUBDIRECTORY(bitmap)
ENDIF(K3D_BUILD_BITMAP_MODULE)

IF(K3D_BUILD_BLOBBY_MODULE)
	ADD_SUBDIRECTORY(blobby)
ENDIF(K3D_BUILD_BLOBBY_MODULE)

IF(K3D_BUILD_BOOLEANS_MODULE)
	ADD_SUBDIRECTORY(booleans)
ENDIF(K3D_BUILD_BOOLEANS_MODULE)

IF(K3D_BUILD_CORE_MODULE)
	ADD_SUBDIRECTORY(core)
ENDIF(K3D_BUILD_CORE_MODULE)

IF(K3D_BUILD_DEFORMATION_MODULE)
	ADD_SUBDIRECTORY(deformation)
ENDIF(K3D_BUILD_DEFORMATION_MODULE)

IF(K3D_BUILD_DEVELOPMENT_MODULE)
	ADD_SUBDIRECTORY(development)
ENDIF(K3D_BUILD_DEVELOPMENT_MODULE)

IF(K3D_BUILD_FILE_EXTENSION_MODULE)
	ADD_SUBDIRECTORY(file_extension)
ENDIF(K3D_BUILD_FILE_EXTENSION_MODULE)

IF(K3D_BUILD_FREETYPE2_MODULE)
	ADD_SUBDIRECTORY(freetype2)
ENDIF(K3D_BUILD_FREETYPE2_MODULE)

IF(K3D_BUILD_GLX_MODULE)
	ADD_SUBDIRECTORY(glx)
ENDIF(K3D_BUILD_GLX_MODULE)

IF(K3D_BUILD_GNOME_MODULE)
	ADD_SUBDIRECTORY(gnome)
ENDIF(K3D_BUILD_GNOME_MODULE)

IF(K3D_BUILD_GRAPHVIZ_MODULE)
	ADD_SUBDIRECTORY(graphviz)
ENDIF(K3D_BUILD_GRAPHVIZ_MODULE)

IF(K3D_BUILD_GTS_MODULE)
	ADD_SUBDIRECTORY(gts)
ENDIF(K3D_BUILD_GTS_MODULE)

IF(K3D_BUILD_GTS_IO_MODULE)
	ADD_SUBDIRECTORY(gts_io)
ENDIF(K3D_BUILD_GTS_IO_MODULE)

IF(K3D_BUILD_IMAGEMAGICK_IO_MODULE)
	ADD_SUBDIRECTORY(imagemagick_io)
ENDIF(K3D_BUILD_IMAGEMAGICK_IO_MODULE)

IF(K3D_BUILD_JPEG_IO_MODULE)
	ADD_SUBDIRECTORY(jpeg_io)
ENDIF(K3D_BUILD_JPEG_IO_MODULE)

IF(K3D_BUILD_K3D_IO_MODULE)
	ADD_SUBDIRECTORY(k3d_io)
ENDIF(K3D_BUILD_K3D_IO_MODULE)

IF(K3D_BUILD_K3DSCRIPT_MODULE)
	ADD_SUBDIRECTORY(k3dscript)
ENDIF(K3D_BUILD_K3DSCRIPT_MODULE)

IF(K3D_BUILD_LINEAR_CURVE_MODULE)
	ADD_SUBDIRECTORY(linear_curve)
ENDIF(K3D_BUILD_LINEAR_CURVE_MODULE)

IF(K3D_BUILD_LSYSTEM_MODULE)
	ADD_SUBDIRECTORY(lsystem)
ENDIF(K3D_BUILD_LSYSTEM_MODULE)

IF(K3D_BUILD_MESH_ATTRIBUTES_MODULE)
	ADD_SUBDIRECTORY(mesh_attributes)
ENDIF(K3D_BUILD_MESH_ATTRIBUTES_MODULE)

IF(K3D_BUILD_MESH_MODULE)
	ADD_SUBDIRECTORY(mesh)
ENDIF(K3D_BUILD_MESH_MODULE)

IF(K3D_BUILD_MESH_INSTANCE_MODULE)
	ADD_SUBDIRECTORY(mesh_instance)
ENDIF(K3D_BUILD_MESH_INSTANCE_MODULE)

IF(K3D_BUILD_NGUI_MODULES)
	ADD_SUBDIRECTORY(ngui_about_dialog)
	ADD_SUBDIRECTORY(ngui_animation_timeline_panel)
	ADD_SUBDIRECTORY(ngui_node_history_panel)
	ADD_SUBDIRECTORY(ngui_node_list_panel)
	ADD_SUBDIRECTORY(ngui_node_properties_panel)
	ADD_SUBDIRECTORY(ngui_pipeline_profiler_panel)
	ADD_SUBDIRECTORY(ngui_timeline_panel)
	ADD_SUBDIRECTORY(ngui_tool_properties_panel)
	ADD_SUBDIRECTORY(ngui_toolbar_panel)
	ADD_SUBDIRECTORY(ngui_undo_tree_panel)
ENDIF(K3D_BUILD_NGUI_MODULES)

IF(K3D_BUILD_NGUI_PIPELINE_PANEL_MODULE)
	ADD_SUBDIRECTORY(ngui_pipeline_panel)
ENDIF(K3D_BUILD_NGUI_PIPELINE_PANEL_MODULE)

IF(K3D_BUILD_NURBS_MODULE)
	ADD_SUBDIRECTORY(nurbs)
ENDIF(K3D_BUILD_NURBS_MODULE)

IF(K3D_BUILD_OBJ_IO_MODULE)
	ADD_SUBDIRECTORY(obj_io)
ENDIF(K3D_BUILD_OBJ_IO_MODULE)

IF(K3D_BUILD_OPENEXR_IO_MODULE)
	ADD_SUBDIRECTORY(openexr_io)
ENDIF(K3D_BUILD_OPENEXR_IO_MODULE)

IF(K3D_BUILD_OPENGL_MODULE)
	ADD_SUBDIRECTORY(opengl)
ENDIF(K3D_BUILD_OPENGL_MODULE)

IF(K3D_BUILD_OPENGL_PAINTERS_MODULE)
	ADD_SUBDIRECTORY(opengl_painters)
ENDIF(K3D_BUILD_OPENGL_PAINTERS_MODULE)

IF(K3D_BUILD_OSX_MODULE)
	ADD_SUBDIRECTORY(osx)
ENDIF(K3D_BUILD_OSX_MODULE)

IF(K3D_BUILD_PDIFF_MODULE)
	ADD_SUBDIRECTORY(pdiff)
ENDIF(K3D_BUILD_PDIFF_MODULE)

IF(K3D_BUILD_PGP_REMESH_MODULE)
	ADD_SUBDIRECTORY(pgp_remesh)
ENDIF(K3D_BUILD_PGP_REMESH_MODULE)

IF(K3D_BUILD_PIXIE_MODULE)
	ADD_SUBDIRECTORY(pixie)
ENDIF(K3D_BUILD_PIXIE_MODULE)

IF(K3D_BUILD_PLOT_MODULE)
	ADD_SUBDIRECTORY(plot)
ENDIF(K3D_BUILD_PLOT_MODULE)

IF(K3D_BUILD_PLY_IO_MODULE)
	ADD_SUBDIRECTORY(ply_io)
ENDIF(K3D_BUILD_PLY_IO_MODULE)

IF(K3D_BUILD_PNG_IO_MODULE)
	ADD_SUBDIRECTORY(png_io)
ENDIF(K3D_BUILD_PNG_IO_MODULE)

IF(K3D_BUILD_POLYHEDRA_MODULE)
	ADD_SUBDIRECTORY(polyhedra)
ENDIF(K3D_BUILD_POLYHEDRA_MODULE)

IF(K3D_BUILD_POINT_GROUP_MODULE)
	ADD_SUBDIRECTORY(point_group)
ENDIF(K3D_BUILD_POINT_GROUP_MODULE)

IF(K3D_BUILD_PRIMITIVES_MODULE)
	ADD_SUBDIRECTORY(primitives)
ENDIF(K3D_BUILD_PRIMITIVES_MODULE)

IF(K3D_BUILD_PYTHON_MODULE)
	ADD_SUBDIRECTORY(python)
ENDIF(K3D_BUILD_PYTHON_MODULE)

IF(K3D_BUILD_QSLIM_MODULE)
	ADD_SUBDIRECTORY(qslim)
ENDIF(K3D_BUILD_QSLIM_MODULE)

IF(K3D_BUILD_QUADRICS_MODULE)
	ADD_SUBDIRECTORY(quadrics)
ENDIF(K3D_BUILD_QUADRICS_MODULE)

#ADD_SUBDIRECTORY(quadrilateral_remeshing)

IF(K3D_BUILD_RENDERMAN_MODULE)
	ADD_SUBDIRECTORY(renderman)
ENDIF(K3D_BUILD_RENDERMAN_MODULE)

IF(K3D_BUILD_RENDERMAN_PAINTERS_MODULE)
	ADD_SUBDIRECTORY(renderman_painters)
ENDIF(K3D_BUILD_RENDERMAN_PAINTERS_MODULE)

IF(K3D_BUILD_SCALAR_MODULE)
	ADD_SUBDIRECTORY(scalar)
ENDIF(K3D_BUILD_SCALAR_MODULE)

IF(K3D_BUILD_SCRIPTED_PLUGINS_MODULE)
	ADD_SUBDIRECTORY(scripted_plugins)
ENDIF(K3D_BUILD_SCRIPTED_PLUGINS_MODULE)

IF(K3D_BUILD_SCRIPTING_MODULE)
	ADD_SUBDIRECTORY(scripting)
ENDIF(K3D_BUILD_SCRIPTING_MODULE)

IF(K3D_BUILD_SELECTION_MODULE)
	ADD_SUBDIRECTORY(selection)
ENDIF(K3D_BUILD_SELECTION_MODULE)

IF(K3D_BUILD_TEST_MODULE)
	ADD_SUBDIRECTORY(test)
ENDIF(K3D_BUILD_TEST_MODULE)

IF(K3D_BUILD_TEXTURE_MODULE)
	ADD_SUBDIRECTORY(texture)
ENDIF(K3D_BUILD_TEXTURE_MODULE)

IF(K3D_BUILD_TIFF_IO_MODULE)
	ADD_SUBDIRECTORY(tiff_io)
ENDIF(K3D_BUILD_TIFF_IO_MODULE)

IF(K3D_BUILD_TIME_MODULE)
	ADD_SUBDIRECTORY(time)
ENDIF(K3D_BUILD_TIME_MODULE)

IF(K3D_BUILD_VIRTUAL_OFFSCREEN_MODULE)
	ADD_SUBDIRECTORY(virtual_offscreen)
ENDIF(K3D_BUILD_VIRTUAL_OFFSCREEN_MODULE)

IF(K3D_BUILD_VIRTUAL_OPENGL_PAINTERS_MODULE)
	ADD_SUBDIRECTORY(virtual_opengl_painters)
ENDIF(K3D_BUILD_VIRTUAL_OPENGL_PAINTERS_MODULE)

IF(K3D_BUILD_WGL_MODULE)
	ADD_SUBDIRECTORY(wgl)
ENDIF(K3D_BUILD_WGL_MODULE)

IF(K3D_BUILD_WINDOWS_MODULE)
	ADD_SUBDIRECTORY(windows)
ENDIF(K3D_BUILD_WINDOWS_MODULE)

IF(K3D_BUILD_YAFRAY_MODULE)
	ADD_SUBDIRECTORY(yafray)
ENDIF(K3D_BUILD_YAFRAY_MODULE)

ADD_SUBDIRECTORY(external)

