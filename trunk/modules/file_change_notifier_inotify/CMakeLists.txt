PROJECT(k3d-file-change-notifier)

IF(K3D_GTHREAD_FOUND)
	SET(USE_THREADS "ON")
ENDIF(K3D_GTHREAD_FOUND)

OPTION(K3D_THREADED_INOTIFY "Use a separate thread to wait for file change events" ${USE_THREADS})
MARK_AS_ADVANCED(K3D_THREADED_INOTIFY)

SET(HEADERS inotify-cxx.h file_change_notifier_base.h)
SET(SOURCES inotify-cxx.cpp module.cpp)

IF(K3D_GTHREAD_FOUND AND K3D_THREADED_INOTIFY)
	SET(SOURCES file_change_notifier_thread.cpp ${SOURCES})
	ADD_DEFINITIONS(-DFILE_CHANGE_NOTIFIER_THREAD)
ELSE(K3D_GTHREAD_FOUND AND K3D_THREADED_INOTIFY)
	SET(SOURCES file_change_notifier_poll.cpp ${SOURCES})
ENDIF(K3D_GTHREAD_FOUND AND K3D_THREADED_INOTIFY)

ADD_LIBRARY(${PROJECT_NAME} SHARED ${HEADERS} ${SOURCES} ${ARGN})
SET_TARGET_PROPERTIES(${PROJECT_NAME} PROPERTIES PREFIX "" SUFFIX ".module")

INSTALL(TARGETS ${PROJECT_NAME}
RUNTIME DESTINATION ${K3D_LIBDIR}/k3d/plugins
LIBRARY DESTINATION ${K3D_LIBDIR}/k3d/plugins)

K3D_CREATE_MODULE_PROXY(${PROJECT_NAME})
TARGET_LINK_LIBRARIES(${PROJECT_NAME} ${K3D_GTHREAD_LIBS})
